# Finance Assistant — Backend

Бэкенд сервиса  **«Финансовый помощник»** : принимает ручные расходы и загруженные чеки (фото), извлекает из них данные (ML составляющая OCR), автоматически категоризирует траты (напр. «еда», «транспорт», «развлечения»), строит агрегаты для графиков и формирует советы по экономии.

## Стек

- **Python 3.11+**
- **FastAPI** (ASGI) — REST + Swagger UI
- **PostgreSQL** — основная БД
- **SQLAlchemy 2.0** + **asyncpg**
- **Alembic** — миграции схемы

## Быстрый старт

### 1) Установка Poetry

Рекомендуемый способ — через `pipx` или официальный установщик:

```bash
pipx install poetry
# или
python -m pip install --user poetry
poetry --version
```

### 2) Клонирование и зависимости

```bash
poetry install
```

### 3) Запуск приложения

```bash
poetry run python -m app.main
# Документация будет доступна на: http://localhost:8000/docs
```

---

## Минимальная модель данных (MVP)

Используются 5 таблиц:

- **users** — учётная запись
- **accounts** — счета пользователя (валюта, название)
- **categories** — категории доходов/расходов (income|expense)
- **transactions** — операции (user, account, category, amount, date, description)
- **receipts** — загруженные файлы чеков и извлечённые метаданные (file_path, merchant, total)

---

## Сквозные сценарии

### Ручной ввод

Пользователь выбирает счёт и категорию, вводит сумму и дату → создаётся запись в `transactions`.

### Загрузка чека

Файл сохраняется в `RECEIPTS_DIR`, создаётся запись в `receipts`. OCR/ML извлекает сумму/магазин/дату и предлагает категорию; пользователь подтверждает → создаётся `transactions`, поле `receipts.transaction_id` заполняется ссылкой на неё.

---

## Разработка

Запуск утилит (если подключены как dev-зависимости):

```bash
# тесты
poetry run pytest -q

# линтеры/форматирование/тайпчек
poetry run ruff check .
poetry run black --check .
poetry run mypy .
```

Запуск в интерактивном окружении:

```bash
poetry shell
python -m app.main
```

## Точки роста (после MVP)

- Хранилище файлов → S3/MinIO (подписанные URL)
- Детализация чеков (`receipt_items`) и сплит по категориям
- Бюджеты, кэш балансов, расширенная аналитика
- Логи ML и мониторинг качества извлечения
